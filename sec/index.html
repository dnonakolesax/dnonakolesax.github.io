<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VKAT V GO</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/styles/github.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 10px 0 10px 0;
        }
        #html-output {
            margin-bottom: 20px;
			margin-left: auto;
			margin-right: auto;
			width: 40vw;
			border: 1px solid gray;
			border-radius:12px;
			padding-left: 10px;
			padding-right: 10px;
        }
		
		@media (max-width: 768px) {
			#html-output {
				width: 90vw !important;
			}
		}
    </style>
</head>
<body>
    <div id="html-output"></div>
	<script src="https://cdn.jsdelivr.net/npm/marked/lib/marked.umd.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/marked-highlight/lib/index.umd.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/highlight.min.js"></script>
    <script>
        function convertMarkdown() {
			const { Marked } = globalThis.marked;
			const { markedHighlight } = globalThis.markedHighlight;
            const markdown = `
# Основы инфобеза

CVE (Common Vulnerabilities and Exposures) — база данных общеизвестных уязвимостей информационной безопасности. Каждой уязвимости присваивается идентификационный номер вида CVE-год-номер.

CWE (Common Weakness Enumeration) - система классификации ошибок, приводящих к уязвимостям.

## OWASP Top-10

Актуально для 2021 года, ждём обновление от 2025.

### 1 - Недостатки в контроле доступа

34 CWE и 19013 CVE связаны с контролем доступа, встречается чаще всего.

Основные недостатки:

- Возможность обхода контроля доступа
- Повышение привелегий
- Неавторизованный доступ к аккаунтам, создание, чтение, удаление и редактирование данных

Все валидации должны быть и на фронте, и на бэке. Валидация на фронте имеет рекомендательный характер, любой недоброжелатель будет пытаться её обойти. С другой стороны, большинство пользователей не пытается вас взломать, поэтому нужно валидировать их ввод на фронте, чтобы не нагружать лишний раз сервер.

Как предотвратить:

- Все ресурсы должны быть запрещены по умолчанию (кроме публичных, т. е. доступных АБСОЛЮТНО ВСЕМ)
- Создавайте механизмы контроля доступа в приложении и переиспользуйте их, минимизируйте междоменное использование
- Не давайте пользователям доступ на удаление, вместо этого проставляйте DELETED_DATE (можно аналогичным образом версионировать update, если есть такая потребность).
- Используйте модели доменов для реализации бизнес-ограничений
- Отключите возможность листинга директорий на сервере, не оставляйте там метаданных и бэкапов
- Логируйте все ошибки доступа и уведомляйте администраторов о многочисленных повторениях
- Ограничивайте частоту доступа к API
- Инвалидируйте stateful сессии после выхода из аккаунта. Если используете JWT - делайте это в паре с refresh, у jwt делайте небольшой срок жизни

### 2 - Ошибки криптографии

29 CWE и 3075 CVE связаны с ошибками криптографии

Как предотвратить:

- Определите те данные, которые ваше приложение хранит, передаёт или обрабатывает, и которые являются конфиденциальными в соответствии с законами или требованиями бизнеса
- Старайтесь без надобности не хранить конфиденциальные данные. Избавляйтесь от них при первой возможности или используйте токенизацию/усечение по стандарту PCI DSS (Payment Card Industry Data Security Standard)  
- Для тех конфиденциальных данных, которые приходится хранить, обеспечьте шифрование
- Используйте актуальные и сильные алгоритмы, протоколы и ключи шифрования. Ключи старайтесь обновлять. Для хранения секретов используйте vault 
- Шифруйте все передаваемые данные с помощью надежного протокола,
например, TLS. Обеспечьте принудительное шифрование, например, с помощью HSTS (HTTP Strict Transport Security)
- Отключите кэширование ответов с конфиденциальными данными
- Не используйте устаревшие протоколы (FTP / SMTP)
- Используйте актуальные алгоритмы хэширования паролей (Argon2, scrypt, bcrypt или PBKDF2), используйте соль
- Для генерации случайных чисел, которые должны быть НЕПРЕДСКАЗУЕМЫМИ, используйте криптостойкие алгоритмы (надеюсь, не надо объяснять, что случайные числа в компьютере не случайны). Можно использовать dev/random, если у вас есть надёжный источник энтропии. Не используйте предсказуемый seed или источники низкой энтропии
- Используйте аутентифицированное шифрование
- Ключи должны быть сгенерированы криптостойким рандомом и храниться как массив байт. Пароли нужно также превращать в ключи
- Не используйте устаревшие алгоритмы: MD5, SHA1, PKCSv1.5
- Проверяйте отдельно эффективность конфигурации и настройки

Отдельно можно рассмотреть доклад про [постквантовое шифрование](https://nvlpubs.nist.gov/nistpubs/ir/2024/NIST.IR.8547.ipd.pdf). Думаю, это появится в 2025.

### 3 - Инъекции

33 CWE и 32078 CVE связаны с инъекциями

SQL-injection:

\`\`\`sql
Login: admin
Password: ' or 1=1 --

Query: SELECT id FROM accounts WHERE login = 'admin' and password = '' or 1=1 -- ...
\`\`\`

Если вы по какой-то причине вдруг зачем-то вызываете консольную команду, будьте уверены в том, что пользователь не сможет подставить ничего такого, что вызовет дополнительные команды.

Если вы используйте server-side rendering, учтите, что пользователь может подставить исполняемый код в запрос, что приведёт к исполнению нежелательного кода на вашей машине.

Такой запрос сможет залогинить вас под админом независимо от пароля. Есть специальный инструмент: sqlmap, он проверяет формы на возможность подобных инъекций.

На фронте клиент может себе подставить что-нибудь подобное:
\`\`\`html
%3Cdiv ...%3E %3Cscript%3E alert('XSS') %3C/script%3E %3C/div%3E
\`\`\`
Код внутри скрипта будет вызываться каждый раз, когда любой пользователь будет открывать страницу. Соответственно, хакер может подставить туда, например, XHR-запрос, который отправит запрос на его сервер, в котором могут содержаться, например, авторизационные куки. Чтобы этого избежать, используйте dom sanitizer, избегайте innerHtml, в шаблонизаторах по типу handlebars избегайте {{{}}}. Используйте CSP.

Как предотвратить:

- Используйте безопасный API для общения с базой (подставляйте параметры, а не склеивайте строки), либо ORM. Также обращайте внимание на склеивание запросов и использование exec() и EXECUTE IMMEDIATE в хранимых процедурах
- В идеале использовать не чёрные списки запрещённых данных (что запрещено), а белые списки(что разрешено), потому что при составлении чёрного списка есть большой шанс что-то пропустить.
- Используйте в запросах LIMIT, чтобы в случае SQL-инъекции было сложнее вывести всю базу
- Экранируйте спецсимволы в запросах. Названия таблиц или столбцов, нельзя экранировать, поэтому предоставляемые пользователями названия представляют опасность.
- Для конфиденциальных кук используйте HTTP ONLY.

### 4 - Небезопасная архитектура

Впервые в топ-10. 40 CWE и 2691 CVE. Небезопасная архитектура предполагает наличие логических ошибок, которые открывают хакерам новые возможности к атакам. Например:

- Контрольные вопросы для сброса пароля. Ответы на эти вопросы может знать несколько людей
- Отсутствие защиты от ботов при покупке дефицитных товаров. Можно рассмотреть как случаи искусственного дефицита (редкие кроссовки), так и случаи вынужденного дефицита (нехватка видеокарт из-за майнеров)
- Кинотеатр предлагает за раз забронировать до 15 мест. Всего имеется 600 мест. Место бронируется на 15 минут, далее требуется его оплатить, чтобы застолбить окончательно. Хакерам будет проще занять все места, что приведёт к массированному падению доходов организации.

Как избежать:

- Организуйте защищённый жизненный цикл приложения, привлекайте специалистов по ИБ, чтобы построить и разработать архитектуру безопасности и систему управления безопасностью
- Создайте и используйте библиотеку безопасных шаблонов проектирования или проверенных готовых к использованию компонентов
- Интегрируйте проверку безопасности на каждом уровне приложения
- Используйте язык безопасности в пользовательских сценариях
- Пишите модульные и интеграционные тесты, составляйте для каждого из них сценарии безопасного и небезопасного использования
- Ограничьте потребление ресурса пользователями или другими сервисами
- Разделяйте слои системы и сети по потребностям в безопасности

### 5 - Некорректная настройка параметров безопасности

20 CWE, 789 CVE.

Логины и пароли по умолчанию, открытые порты (привет, DeepSeekовский ClickHouse), устаревшие компоненты, выкидывание стектрейсов пользователю, отключение функций безопасности.

Как избежать:

- Конфигурируйте дев, тест стенды и прод одинаково, но с разными данными для доступа, чтобы была воспроизводимость процессов создания безопасных сред
- Не используйте лишние и сомнительные компоненты или фреймворки
- Следите за CVE и прочими источниками (NVD, VulDB, Snyk, ICS-SERT) и вовремя реагируйте на уязвимости, проверяйте конфиги облачных хранилищ
- Эффективно изолируйте компоненты друг от друга с помощью контейнеризации (не забывайте про VM escape атаки) или облачных групп безопасности.
- Используйте [безопасные заголовки](https://cheatsheetseries.owasp.org/cheatsheets/HTTP_Headers_Cheat_Sheet.html) или другие безопасные директивы для клиентов
- Используйте автоматизированные средства проверки конфигураций и настроек

### 6 - Уязвимые и устаревшие компоненты

3 CWE, 0 CVE    

Как избежать:

- Удаляйте неиспользуемые компоненты и зависимости, ненужные фичи и прочее
- Регулярно проверяйте актуальность фреймворков и библиотек, а также их зависимостей, используя такие инструменты как versions, DependencyCheck, DependaBot в гитхабе, и т.д. Используйте инструменты для анализа ПО, подписывайтесь на рассылки
- Загружайте фреймворки и библиотеки из официальных источников по безопасным ссылкам.
- Следите за фреймворками и библиотеками, которые не получают обновления или больше не поддерживаются. Если нужно, пробуйте использовать виртуальные патчи.

### 7 - Ошибки идентификации и аутентификации

22 CWE, 3897 CVE

Как избежать:

- Добавляйте мультифакторную аутентификацию
- Не используйте логин/пароль по умолчанию, тем более для админов
- Проверяйте пароли на слабость, сравнивайте с топ-10000 худших паролей
- Используйте сложные пароли. Можно измерить [здесь](https://www.omnicalculator.com/other/password-entropy) энтропию пароля (должна быть не меньше 60). Не нужно полагаться на эту метрику на 100%, но она довольно-таки показательная
- Используйте сессии, храните их в надёжном месте, вовремя инвалидируйте их
- Ограничьте количество неправильных аутентификаций, добавьте задержку, логируйте и передавайте администрацию все потенциальные атаки
- Делайте ошибки чуть менее информативными, чтобы избежать атак. Вместо "пароль неправильный" или "пользователь не существует" пишите "неправильный логин или пароль"

### 8 - Ошибки целостности ПО и данных

Впервые в топе. 10 CWE, 1152 CVE

Как избежать:

- Используйте цифровые подписи для верификации ПО или сериализованных данных из сторонних источников
- Убедитесь, что пакетные менеджеры (npm для js, maven для java, ...) получают обновления из надёжных репозиториев.
- Убедитесь, что стороннее ПО использует OWASP Dependency Check или OWASP CycloneDX для проверки на наличие уязвимостей.
- Проводите код-ревью для уменьшения шансов внедрения вредоносного кода
- Убедитесь, что CI/CD гарантирует целостность кода, проходящего через процессы сборки и развертывания.
- Убедитесь, что незашифрованные или неподписанные данные передаются вместе с некоторым способом проверки их целостности.

### 9 - Ошибки систем логирования и мониторинга безопасности

4 CWE, 242 CVE

Как избежать:

- Регистрировать и хранить все ошибки доступа и проверки данных на стороне сервера с указанием контекста, чтобы было понятно, что случилось
- Писать логи в подходящем формате для хранения менджером логов
- Избегать атак на логирующие системы или системы мониторинга
- Контролировать целостность журналов аудита важных транзакций для предотвращения подмены или удаления данных, например, с помощью таблиц, в которые можно только добавлять данные
- Использовать эффективные системы мониторинга и предупреждения (SIEM)
- Разработать механизмы реагирования на инциденты и устранения их последствий

### 10 - SSRF

1 CWE, 385 CVE, включён в топ впервые по просьбе сообщества

Server-Side Request Forgery - подделка запроса на стороне сервера – это атака, которая позволяет отправлять запросы от имени сервера к внешним или внутренним ресурсам.

Как избежать:

- Не давайте серверу возможности ходить в сторонние ресурсы
- Используйте политику "deny by default" в вашем firewall
- Валидируйте и очищайте все введённые пользователем данные
- Создайте белый список для URL, портов и прочих конечных точек
- Не посылайте сырые запросы к клиентам
- Отключите HTTP Redirect
- Помните о согласованности URL-адресов, чтобы избежать таких атак, как перепривязка DNS и состояния гонки [TOCTOU](https://en.wikipedia.org/wiki/Time-of-check_to_time-of-use)

### CSRF

Раз уж был упомянут SSRF, не стоит забывать и о CSRF (Client-Side Request Forgery). Например, вы можете нажать на кнопку, которая подтверждает некоторую форму, например, перевод денег на чужой счёт. Чтобы избежать этого, на каждую форму выдавайте CSRF-токен:  сервер создаёт случайный токен и отправляет его браузеру клиента. Когда браузер запрашивает у сервера информацию, сервер, прежде чем дать ответ, требует показать ключ и проверяет его достоверность.

### CORS

Чтобы чужой фронт не дёргал ваш бэк, необходимо грамотно настроить CORS (современные браузеры будут блокировать запросы, которые не получат ответ на options)

Список заголовков для Options:

- Access-Control-Allow-Origin
- Access-Control-Allow-Credentials
- Access-Control-Expose-Headers
- Access-Control-Max-Age
- Access-Control-Allow-Methods
- Access-Control-Allow-Headers

### Cookie

Для секретных используйте HTTP-only, чтобы js не имел к ним доступа

Если не хотите передавать куки тогда, когда пользователь не пришёл с того же сайта, используйте samesite=strict.

### CSP ограничения

- connect-src - ограничивает, куда можно подключаться с помощью xhw, ws и прочего
- img-src
- style-src
- script-src
- font-src
- media-src - audio, video, track
- child-src - iframes
- form-action
- base-uri
- default-src

## CWE TOP-25

Актуально на 2024 год, ждём 2025.
https://cwe.mitre.org/top25/

1. XSS [CWE-79](https://cwe.mitre.org/data/definitions/79.html)
2. Out-of-bound writes (запись за границы буфера) [CWE-787](https://cwe.mitre.org/data/definitions/787.html)
3. SQL инъекция [CWE-89](https://cwe.mitre.org/data/definitions/89.html)
4. CSRF [CWE-352](https://cwe.mitre.org/data/definitions/352.html)
5. Path Traversal (доступ к файлам на сервере) [CWE-22](https://cwe.mitre.org/data/definitions/22.html)
6. Out-of-bouns read (чтение за пределами буфера) [CWE-125](https://cwe.mitre.org/data/definitions/125.html)
7. OS Command Injection [CWE-78](https://cwe.mitre.org/data/definitions/78.html)
8. Use After Free (использование памяти после освобождения) [CWE-416](https://cwe.mitre.org/data/definitions/416.html)
9. Missing Authorization (отсутствие авторизации) [CWE-862](https://cwe.mitre.org/data/definitions/862.html)
10. Unrestricted Upload of File with Dangerous Type (запрещённая загрузка опасного файла) [CWE-434](https://cwe.mitre.org/data/definitions/434.html)
11. Code injection [CWE-94](https://cwe.mitre.org/data/definitions/94.html)
12. Неправильная валидация ввода [CWE-20](https://cwe.mitre.org/data/definitions/20.html)
13. Command injection [CWE-77](https://cwe.mitre.org/data/definitions/77.html)
14. Неправильная аутентификация [CWE-287](https://cwe.mitre.org/data/definitions/287.html)
15. Повышение привелегий [CWE-269](https://cwe.mitre.org/data/definitions/269.html)
16. Десериализация ненадёжных данных [CWE-502](https://cwe.mitre.org/data/definitions/502.html)
17. Выдача конфиденциальной информаци неавторизованному пользователю [CWE-200](https://cwe.mitre.org/data/definitions/200.html)
18. Неправильная авторизация [CWE-863](https://cwe.mitre.org/data/definitions/863.html)
19. SSRF [CWE-918](https://cwe.mitre.org/data/definitions/918.html)
20. Неправильное ограничение операций в пределах буфера памяти [CWE-119](https://cwe.mitre.org/data/definitions/119.html)
21. Разыменование NULL указателя [CWE-476](https://cwe.mitre.org/data/definitions/476.html)
22. Захардкоженные данные для доступа [CWE-798](https://cwe.mitre.org/data/definitions/798.html)
23. Переполнение целого числа [CWE-190](https://cwe.mitre.org/data/definitions/190.html)
24. Неконтролируемое потребление ресурса [CWE-400](https://cwe.mitre.org/data/definitions/400.html)
25. Отсутствие аутентификации в критической функции [CWE-306](https://cwe.mitre.org/data/definitions/306.html)
            `
            const marked = new Marked(
								  markedHighlight({
									emptyLangClass: 'hljs',
									langPrefix: 'hljs language-',
									highlight(code, lang, info) {
									  const language = hljs.getLanguage(lang) ? lang : 'plaintext';
									  return hljs.highlight(code, { language }).value;
									}
								  })
								);
            const html = marked.parse(markdown);
            
            document.getElementById('html-output').innerHTML = html;
        }
	convertMarkdown()
    </script>
</body>
</html>          